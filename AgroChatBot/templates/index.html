{% extends "base.html" %}
{% block content %}
<div class="container">
  <aside class="sidebar">
    <h3>Your profile</h3>
    {% if current_user.is_authenticated %}
      <p><strong>{{ current_user.name or current_user.email }}</strong></p>
      <p>Crop: {{ current_user.primary_crop or "â€”" }}</p>
      <p>Region: {{ current_user.region or "â€”" }}</p>
      <p>Lang: {{ current_user.preferred_language or "en" }}</p>
      <a class="btn" href="{{ url_for('profile') }}">Edit profile</a>
    {% else %}
      <p><a href="{{ url_for('login') }}">Login</a> to save chat & see profile.</p>
    {% endif %}
    {% if recent_users %}
      <hr>
      <h4>Recent users (admin)</h4>
      <ul class="user-list">
        {% for u in recent_users %}
          <li><a href="{{ url_for('admin_view_user', user_id=u.id) }}">{{ u.email }} - {{ u.name or 'â€”' }}</a></li>
        {% endfor %}
      </ul>
    {% endif %}
  </aside>

  <section class="chat-panel">
    <div id="messages" class="messages" aria-live="polite"></div>

    <!-- âœ… Chat form with file upload support -->
    <form id="chatForm" class="chat-form" onsubmit="return false;">
      <div class="input-group">
        <!-- Attach button -->
        <button id="attachBtn" type="button" class="btn attach-btn" title="Attach a file">ðŸ“Ž</button>

        <!-- Hidden file input -->
        <input type="file" id="file-input"
               accept=".jpg,.jpeg,.png,.pdf,.docx,.txt,.csv,.xlsx"
               style="display:none;">

        <!-- Message input -->
        <input id="msg"
               aria-label="Type your question"
               placeholder="Ask about crops, pests or soil (e.g. 'best soil for cotton')"
               autocomplete="off">

        <!-- Send button -->
        <button id="sendBtn" type="button" class="btn send-btn">Send</button>
      </div>
    </form>
  </section>
</div>

<style>
  /* Optional: make chat input layout nicer */
  .chat-form {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px;
  }

  .input-group {
    display: flex;
    width: 100%;
    align-items: center;
  }

  .attach-btn {
    font-size: 1.3rem;
    background: #f3f3f3;
    border: none;
    cursor: pointer;
    padding: 6px 10px;
    border-radius: 8px;
  }

  .send-btn {
    background-color: #28a745;
    color: white;
    font-weight: bold;
    padding: 8px 14px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }

  #msg {
    flex-grow: 1;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 8px 10px;
    outline: none;
  }

  #msg:focus {
    border-color: #28a745;
  }
</style>
{% endblock %}
